---
title: Compléter une mission
description: Marque une mission comme terminée avec un reçu de complétion.
---

import { Aside } from '@astrojs/starlight/components';

## POST /missions/`{id}`/complete

Marque une mission comme `completed`. Cet endpoint est principalement appelé par l'application mobile de l'opérateur. Il peut aussi être appelé par un dispatcher pour forcer la complétion.

<Aside type="caution">
  Cet endpoint attend du `multipart/form-data`, pas du JSON.
</Aside>

### Path params

| Paramètre | Type | Requis | Description |
|-----------|------|--------|-------------|
| `id` | string (UUID) | Oui | Identifiant de la mission à compléter. |

### Body (`multipart/form-data`)

| Paramètre | Type | Requis | Description |
|-----------|------|--------|-------------|
| `amount` | string | Oui | Montant du reçu (ex: `"150.00"`). |
| `payment_method` | string | Non | Méthode de paiement (ex: `cash`, `card`, `transfer`). |
| `notes` | string | Non | Notes de complétion de l'opérateur. |
| `latitude` | number | Non | Latitude de la position au moment de la complétion. |
| `longitude` | number | Non | Longitude de la position au moment de la complétion. |
| `photo` | file | Non | Photo de preuve / reçu (upload fichier). |

### Exemple de requête

```bash
curl -X POST https://api.dispatchkit.io/api/v1/missions/c3d4e5f6-a7b8-9012-cdef-123456789012/complete \
  -H "Authorization: Bearer {token}" \
  -F "amount=150.00" \
  -F "payment_method=cash" \
  -F "notes=Livraison effectuée sans incident." \
  -F "latitude=48.8698" \
  -F "longitude=2.3311" \
  -F "photo=@/path/to/receipt.jpg"
```

### Réponse `200 OK`

La réponse contient la mission mise à jour avec le statut `completed` et le reçu associé.

```json
{
  "id": "c3d4e5f6-a7b8-9012-cdef-123456789012",
  "mission_number": 42,
  "title": "Livraison Rue de la Paix",
  "status": "completed",
  "receipt": {
    "id": "d4e5f6a7-b890-1234-cdef-567890123456",
    "amount": "150.00",
    "payment_method": "cash",
    "notes": "Livraison effectuée sans incident.",
    "photo_url": "uploads/receipts/receipt-abc123.jpg"
  },
  "created_at": "2024-01-15T09:00:00Z",
  "updated_at": "2024-01-15T10:45:00Z"
}
```

### Erreurs

| Code HTTP | Description |
|-----------|-------------|
| `400` | Données invalides (champ `amount` manquant, ID invalide) |
| `404` | Mission introuvable |
| `422` | La mission n'est pas dans un statut complétable |
